<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Ponto App{% endblock %}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="/static/css/styles.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="app-container">
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <h2><i class="fas fa-clock"></i> Ponto App</h2>
      </div>
      <ul class="nav-menu">
        <li><a href="/dashboard" class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}">
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </a></li>
        <li><a href="/historico" class="nav-link {% if request.endpoint == 'historico' %}active{% endif %}">
          <i class="fas fa-history"></i> Histórico
        </a></li>
        <li><a href="/relatorios" class="nav-link {% if request.endpoint == 'relatorios' %}active{% endif %}">
          <i class="fas fa-chart-bar"></i> Relatórios
        </a></li>
        <li><a href="/perfil" class="nav-link {% if request.endpoint == 'perfil' %}active{% endif %}">
          <i class="fas fa-user"></i> Perfil
        </a></li>
        <li class="admin-only" style="display: none;"><a href="/admin" class="nav-link {% if request.endpoint == 'admin' %}active{% endif %}">
          <i class="fas fa-user-shield"></i> Admin
        </a></li>
        <li><a href="#" onclick="logout()" class="nav-link">
          <i class="fas fa-sign-out-alt"></i> Sair
        </a></li>
      </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <header class="content-header">
        <h1>{% block page_title %}{% endblock %}</h1>
        <div class="current-time">
          <i class="fas fa-clock"></i>
          <span id="current-time"></span>
        </div>
      </header>
      
      <div class="content-body">
        {% block content %}{% endblock %}
      </div>
    </main>
  </div>

  <!-- Status Messages -->
  <div id="status-message" class="status-message"></div>

  <script>
    // Função para obter token
    function getToken() {
      return localStorage.getItem('token') || '';
    }

    // Função para logout
    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/login';
    }

    // Verificar se está logado
    function checkAuth() {
      const token = getToken();
      if (!token) {
        window.location.href = '/login';
        return false;
      }
      return true;
    }

    // Atualizar horário atual
    function updateCurrentTime() {
      const now = new Date();
      const timeString = now.toLocaleString('pt-BR', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      document.getElementById('current-time').textContent = timeString;
    }

    // Mostrar mensagem de status
    function showStatus(message, type = 'info') {
      const statusEl = document.getElementById('status-message');
      statusEl.textContent = message;
      statusEl.className = `status-message ${type} show`;
      setTimeout(() => {
        statusEl.classList.remove('show');
      }, 5000);
    }

    // Inicializar página
    document.addEventListener('DOMContentLoaded', function() {
      if (!checkAuth()) return;
      updateCurrentTime();
      setInterval(updateCurrentTime, 1000);
      
      // Verificar se é admin e mostrar menu admin
      const isAdmin = localStorage.getItem('is_admin') === 'true';
      if (isAdmin) {
        const adminMenus = document.querySelectorAll('.admin-only');
        adminMenus.forEach(menu => menu.style.display = 'block');
      }
    });

    {% block scripts %}{% endblock %}
  </script>
</body>
</html>

